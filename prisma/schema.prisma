// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model SuperAdmin {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  email    String  @unique
  password String
  name     String
  phone    String?

  role      AdminRole @default(SUPER_ADMIN)
  isActive  Boolean   @default(true)
  lastLogin DateTime?

  //permission
  permissions String[]

  //security
  twoFactorEnabled Boolean   @default(false)
  loginAttempts    Int       @default(0)
  lockoutUntil     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  //Relationships
  subAdmins     SubAdmin[]
  adminSessions AdminSession[]
  adminLogs     AdminLog[]
  rejectedEvents Event[] @relation("RejectedEvents") // ADD THIS LINE

  @@map("super_admins")
}

enum AdminRole {
  SUPER_ADMIN
  SUB_ADMIN
}

enum AdminType {
  SUPER_ADMIN
  SUB_ADMIN
}

model AdminSession {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  adminId      String    @db.ObjectId
  token        String    @unique
  refreshToken String    @unique
  deviceInfo   String?
  ipAddress    String?
  userAgent    String?
  expiresAt    DateTime
  createdAt    DateTime  @default(now())
  adminType    AdminType

  // Relations (optional - depending on type)
  superAdminId String?     @db.ObjectId
  superAdmin   SuperAdmin? @relation(fields: [superAdminId], references: [id])

  subAdminId String?   @db.ObjectId
  subAdmin   SubAdmin? @relation(fields: [subAdminId], references: [id])

  @@index([adminId, adminType])
  @@map("admin_sessions")
}

// Admin Activity Logs
model AdminLog {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  adminId    String    @db.ObjectId
  action     String
  resource   String?
  resourceId String?
  details    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime  @default(now())
  adminType  AdminType

  // Relations (optional)
  superAdminId String?     @db.ObjectId
  superAdmin   SuperAdmin? @relation(fields: [superAdminId], references: [id])

  subAdminId String?   @db.ObjectId
  subAdmin   SubAdmin? @relation(fields: [subAdminId], references: [id])

  @@index([adminId, adminType])
  @@index([action])
  @@index([createdAt])
  @@map("admin_logs")
}

model SubAdmin {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  email     String    @unique
  password  String
  name      String
  phone     String?
  role      String    @default("SUB_ADMIN")
  isActive  Boolean   @default(true)
  lastLogin DateTime?

  // Permissions (restricted compared to Super Admin)
  permissions String[]

  // Assigned by Super Admin
  createdById String     @db.ObjectId
  createdBy   SuperAdmin @relation(fields: [createdById], references: [id])

  // Security
  twoFactorEnabled Boolean   @default(false)
  loginAttempts    Int       @default(0)
  lockoutUntil     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  adminSessions AdminSession[]
  adminLogs     AdminLog[]

  @@map("sub_admins")
}

model User {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  email    String? @unique
  password String  @default("TEMP_PASSWORD")

  firstName        String
  lastName         String
  phone            String?
  avatar           String?
  role             UserRole  @default(ATTENDEE)
  isVerified       Boolean   @default(false)
  isActive         Boolean   @default(true)
  emailVerified    Boolean   @default(false)
  phoneVerified    Boolean   @default(false)
  twoFactorEnabled Boolean   @default(false)
  lastLogin        DateTime?
  loginAttempts    Int       @default(0)
  lockoutUntil     DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // ðŸ”¥ PASSWORD RESET FIELDS - ADD THESE
  resetToken           String?
  resetTokenExpiry     DateTime?
  otp                  String?
  otpExpiry            DateTime?
  lastPasswordChange   DateTime?
  passwordResetAttempts Int     @default(0)

  // Profile Information
  bio             String?
  website         String?
  linkedin        String?
  twitter         String?
  instagram       String?
  company         String?
  companyIndustry String?
  jobTitle        String?
  location        String?
  timezone        String?
  language        String   @default("en")
  interests       String[] @default([])

  // Organizer-specific fields
  organizationName String?
  description      String?
  headquarters     String?
  founded          String?
  teamSize         String?
  specialties      String[]
  achievements     String[]
  certifications   String[]

  // Business Information
  businessEmail   String?
  businessPhone   String?
  businessAddress String?
  taxId           String?

  // Statistics (computed fields)
  totalEvents    Int   @default(0)
  activeEvents   Int   @default(0)
  totalAttendees Int   @default(0)
  totalRevenue   Float @default(0)

  // ========== RELATIONSHIPS ==========
  organizedEvents          Event[]              @relation("EventOrganizer")
  registrations            EventRegistration[]
  speakerSessions          SpeakerSession[]
  speakerMaterials         Material[]           @relation("SpeakerMaterials")
  exhibitorBooths          ExhibitorBooth[]
  products                 Product[]
  venueBookings            VenueBooking[]
  sentMessages             Message[]            @relation("MessageSender")
  receivedMessages         Message[]            @relation("MessageReceiver")
  reviews                  Review[]
  payments                 Payment[]
  legaldoc                 LegalDocument[]      @relation("VenueLegalDocuments")
  notifications            Notification[]
  analytics                UserAnalytics[]
  settings                 Settings?
  campaigns                Campaign[]
  broadcastsSent           Broadcast[]          @relation("BroadcastSender")
  broadcastsReceived       BroadcastRecipient[]
  venueEvents              Event[]              @relation("EventVenue")
  exhibitorReviews         Review[]             @relation("ExhibitorReviews")
  venueReviews             Review[]             @relation("VenueReviews")
  organizerReviews         Review[]             @relation("OrganizerReviews")
  venueAnalytics           VenueAnalytics[]
  meetingSpaces            MeetingSpace[]
  leads                    EventLead[]
  organizerPromotions      Promotion[]          @relation("OrganizerPromotions")
  exhibitorPromotions      Promotion[]          @relation("ExhibitorPromotions")
  savedEvents              SavedEvent[]
  replies                  ReviewReply[]
  connectionsSent          Connection[]         @relation("ConnectionSender")
  connectionsReceived      Connection[]         @relation("ConnectionReceiver")
  venueAppointments        VenueAppointment[]   @relation("VenueAppointments")
  venueAppointmentRequests VenueAppointment[]   @relation("VenueAppointmentRequests")
  verificationCodes        VerificationCode[]
  createdTickets           SupportTicket[]      @relation("TicketCreator")
  assignedTickets          SupportTicket[]      @relation("TicketAssignee")
  ticketReplies            SupportTicketReply[] @relation("TicketReplyAuthor")

  // ADMIN NOTES RELATIONSHIPS
  adminNotesCreated  AdminNote[]        @relation("AdminNoteCreator")
  noteCollaborations NoteCollaborator[] @relation("NoteCollaborations")

  // Relations for organizer-speaker
  organizerId String? @db.ObjectId
  organizer   User?   @relation("OrganizerSpeakers", fields: [organizerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  speakers    User[]  @relation("OrganizerSpeakers")

  // Exhibitor relation
  organizerIdForExhibitor String? @db.ObjectId
  organizerForExhibitor   User?   @relation("OrganizerExhibitors", fields: [organizerIdForExhibitor], references: [id], onDelete: NoAction, onUpdate: NoAction)
  exhibitors              User[]  @relation("OrganizerExhibitors")

  // Venue Manager relation
  organizerIdForVenueManager String? @db.ObjectId
  organizerForVenueManager   User?   @relation("OrganizerVenueManagers", fields: [organizerIdForVenueManager], references: [id], onDelete: NoAction, onUpdate: NoAction)
  venueManagers              User[]  @relation("OrganizerVenueManagers")

  followers Follow[] @relation("UserFollowing")
  following Follow[] @relation("UserFollowers")

  // Venue fields
  venueName        String?
  venueDescription String?
  venueAddress     String?
  venueCity        String?
  venueState       String?
  venueCountry     String?
  venueZipCode     String?
  venuePhone       String?
  venueEmail       String?
  venueWebsite     String?
  maxCapacity      Int?
  totalHalls       Int?
  activeBookings   Int?
  averageRating    Float    @default(0)
  totalReviews     Int      @default(0)
  amenities        String[]
  venueImages      String[]
  venueVideos      String[]
  floorPlans       String[]
  virtualTour      String?
  basePrice        Float?
  venueCurrency    String   @default("USD")
  latitude         Float?
  longitude        Float?

  // Speaker fields
  speakingExperience String?

  // Appointment relationships
  appointmentsRequested Appointment[] @relation("AppointmentRequester")
  appointmentsReceived  Appointment[] @relation("AppointmentExhibitor")

  exhibitorManuals ExhibitorManual[] @relation("ExhibitorManualUploads")

  subscriptions Subscription[]

  @@map("users")
}
enum UserRole {
  ADMIN
  ORGANIZER
  ATTENDEE
  SPEAKER
  EXHIBITOR
  VENUE_MANAGER
}

// Event Management
model Event {
  id               String      @id @default(auto()) @map("_id") @db.ObjectId
  title            String
  description      String
  shortDescription String?
  slug             String      @unique
  status           EventStatus @default(DRAFT)
  category         String[]
  edition          String?
  tags             String[]
  eventType        String[]

  isFeatured Boolean? @default(false)
  isVIP      Boolean? @default(false)

  // Dates and Times
  startDate         DateTime
  endDate           DateTime
  registrationStart DateTime
  registrationEnd   DateTime
  timezone          String

  // Location
  venueId     String? @db.ObjectId
  venue       User?   @relation("EventVenue", fields: [venueId], references: [id])
  isVirtual   Boolean @default(false)
  virtualLink String?

  // Capacity and Pricing
  maxAttendees     Int?
  currentAttendees Int    @default(0)
  currency         String @default("USD")

  // Media
  images         String[]
  videos         String[]
  brochure       String?
  layoutPlan     String?
  documents      String[]
  bannerImage    String?
  thumbnailImage String?

  // Settings
  isPublic         Boolean @default(true)
  requiresApproval Boolean @default(false)
  allowWaitlist    Boolean @default(false)
  refundPolicy     String?

  // SEO
  metaTitle       String?
  metaDescription String?

  // Organizer
  organizerId String @db.ObjectId
  organizer   User   @relation("EventOrganizer", fields: [organizerId], references: [id])

  // Exhibition Spaces
  exhibitionSpaces ExhibitionSpace[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  averageRating Float @default(0)
  totalReviews  Int   @default(0)

  // REJECTION FIELDS - ADD THESE
  rejectionReason String?        // Reason for rejection
  rejectedAt      DateTime?      // When it was rejected
  rejectedById    String?        @db.ObjectId  // Admin who rejected it
  rejectedBy      SuperAdmin?    @relation("RejectedEvents", fields: [rejectedById], references: [id])

  // Relationships
  registrations    EventRegistration[]
  speakerSessions  SpeakerSession[]
  exhibitorBooths  ExhibitorBooth[]
  reviews          Review[]
  analytics        EventAnalytics[]
  campaigns        Campaign[]
  leads            EventLead[]
  promotions       Promotion[]
  savedEvents      SavedEvent[]
  appointments     Appointment[]
  ticketTypes      TicketType[]
  exhibitorManuals ExhibitorManual[]
  conference       Conference[]
  categories       EventsOnCategories[]
  countries        EventsOnCountries[]
  cities           EventsOnCities[]

  @@map("events")
}

enum EventStatus {
  DRAFT
  PENDING_APPROVAL
  REJECTED
  PUBLISHED
  CANCELLED
  COMPLETED
}

model TicketType {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id])

  name           String
  description    String?
  price          Float
  earlyBirdPrice Float?
  earlyBirdEnd   DateTime?
  quantity       Int
  sold           Int       @default(0)
  isActive       Boolean   @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  eventLeads EventLead[]

  @@map("ticket_types")
}

// Appointment Management Model
model Appointment {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  eventId     String @db.ObjectId
  event       Event  @relation(fields: [eventId], references: [id])
  requesterId String @db.ObjectId
  requester   User   @relation("AppointmentRequester", fields: [requesterId], references: [id])
  exhibitorId String @db.ObjectId
  exhibitor   User   @relation("AppointmentExhibitor", fields: [exhibitorId], references: [id])

  title       String
  description String?
  type        AppointmentType     @default(CONSULTATION)
  status      AppointmentStatus   @default(PENDING)
  priority    AppointmentPriority @default(MEDIUM)

  requestedDate DateTime
  requestedTime String
  duration      Int
  confirmedDate DateTime?
  confirmedTime String?

  meetingType MeetingType @default(IN_PERSON)
  location    String?
  meetingLink String?

  purpose String?
  agenda  String[]
  notes   String?
  outcome String?

  reminderSent     Boolean @default(false)
  followUpRequired Boolean @default(true)

  requesterCompany String?
  requesterTitle   String?
  requesterPhone   String?
  requesterEmail   String?

  cancellationReason String?
  cancelledBy        String?
  cancelledAt        DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("appointments")
}

enum AppointmentType {
  PRODUCT_DEMO
  CONSULTATION
  FOLLOW_UP
  NETWORKING
  TECHNICAL_DISCUSSION
  PARTNERSHIP_DISCUSSION
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  RESCHEDULED
  NO_SHOW
}

enum AppointmentPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum MeetingType {
  IN_PERSON
  VIRTUAL
  PHONE
  HYBRID
}

model ExhibitionSpace {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id])

  spaceType   ExhibitionSpaceType
  name        String
  description String
  dimensions  String?
  area        Float
  location    String?

  basePrice   Float
  pricePerSqm Float?
  minArea     Float?
  currency    String @default("USD")

  powerIncluded       Boolean @default(false)
  additionalPowerRate Float?
  compressedAirRate   Float?

  unit         String?
  pricePerUnit Float?

  isFixed      Boolean @default(false)
  isAvailable  Boolean @default(true)
  maxBooths    Int?
  bookedBooths Int     @default(0)

  setupRequirements Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  exhibitorBooths ExhibitorBooth[]

  @@map("exhibition_spaces")
}

enum ExhibitionSpaceType {
  SHELL_SPACE
  RAW_SPACE
  TWO_SIDE_OPEN
  THREE_SIDE_OPEN
  FOUR_SIDE_OPEN
  MEZZANINE
  ADDITIONAL_POWER
  COMPRESSED_AIR
  CUSTOM
}

model ExhibitorBooth {
  id             String          @id @default(auto()) @map("_id") @db.ObjectId
  eventId        String          @db.ObjectId
  event          Event           @relation(fields: [eventId], references: [id])
  exhibitorId    String          @db.ObjectId
  exhibitor      User            @relation(fields: [exhibitorId], references: [id])
  spaceId        String          @db.ObjectId
  space          ExhibitionSpace @relation(fields: [spaceId], references: [id])
  spaceReference String?

  boothNumber String
  companyName String
  description String?

  additionalPower Float @default(0)
  compressedAir   Float @default(0)

  setupRequirements Json?
  specialRequests   String?

  totalCost Float
  currency  String @default("USD")

  status BoothStatus @default(BOOKED)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([eventId, exhibitorId])
  @@map("exhibitor_booths")
}

model Promotion {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  organizerId String? @db.ObjectId
  organizer   User?   @relation("OrganizerPromotions", fields: [organizerId], references: [id])

  exhibitorId String? @db.ObjectId
  exhibitor   User?   @relation("ExhibitorPromotions", fields: [exhibitorId], references: [id])

  eventId String? @db.ObjectId
  event   Event?  @relation(fields: [eventId], references: [id])

  packageType      String
  targetCategories String[]
  status           String   @default("PENDING")
  amount           Float
  duration         Int

  startDate DateTime
  endDate   DateTime

  impressions Int @default(0)
  clicks      Int @default(0)
  conversions Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("promotions")
}

model MeetingSpace {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  capacity    Int
  area        Float
  hourlyRate  Float
  isAvailable Boolean @default(true)
  userId      String  @db.ObjectId
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("meeting_spaces")
}

// Speaker Management
model SpeakerSession {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  eventId   String @db.ObjectId
  event     Event  @relation(fields: [eventId], references: [id])
  speakerId String @db.ObjectId
  speaker   User   @relation(fields: [speakerId], references: [id])

  title       String
  description String
  sessionType SessionType
  duration    Int
  startTime   DateTime
  endTime     DateTime
  room        String?

  abstract           String?
  learningObjectives String[]
  targetAudience     String?
  materials          Material[]
  youtube            String[]

  status SessionStatus @default(SCHEDULED)

  averageRating Float @default(0)
  totalRatings  Int   @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("speaker_sessions")
}

enum SessionType {
  KEYNOTE
  PRESENTATION
  WORKSHOP
  PANEL
  ROUNDTABLE
}

enum SessionStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BoothStatus {
  BOOKED
  CONFIRMED
  SETUP
  ACTIVE
  COMPLETED
  CANCELLED
}

// Material Management
model Material {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  sessionId String         @db.ObjectId
  session   SpeakerSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  speakerId String         @db.ObjectId
  speaker   User           @relation("SpeakerMaterials", fields: [speakerId], references: [id], onDelete: Cascade)

  fileName String
  fileUrl  String
  publicId String
  fileSize Int
  fileType MaterialType?
  mimeType String

  status        MaterialStatus? @default(DRAFT)
  allowDownload Boolean         @default(true)
  description   String?
  version       String?         @default("1.0")

  uploadedAt   DateTime  @default(now())
  lastModified DateTime  @updatedAt
  deadline     DateTime?

  downloadCount Int @default(0)
  viewCount     Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sessionId])
  @@index([speakerId])
  @@map("materials")
}

enum MaterialType {
  PRESENTATION
  DOCUMENT
  VIDEO
  IMAGE
  OTHER
}

enum MaterialStatus {
  DRAFT
  FINAL
  ARCHIVED
}

// Registration Management
model EventRegistration {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id])
  userId  String @db.ObjectId
  user    User   @relation(fields: [userId], references: [id])

  ticketTypeId String
  quantity     Int    @default(1)
  totalAmount  Float
  currency     String @default("USD")

  status RegistrationStatus @default(PENDING)

  specialRequests     String?
  dietaryRestrictions String?

  paymentId String?  @db.ObjectId
  payment   Payment? @relation(fields: [paymentId], references: [id])

  registeredAt DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("event_registrations")
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  REFUNDED
  WAITLISTED
}

model VenueBooking {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  venueId String @db.ObjectId
  venue   User   @relation(fields: [venueId], references: [id])

  startDate   DateTime
  endDate     DateTime
  totalAmount Float
  currency    String   @default("USD")

  meetingSpaces String[]

  status BookingStatus @default(PENDING)

  purpose         String?
  specialRequests String?

  paymentId String?  @db.ObjectId
  payment   Payment? @relation(fields: [paymentId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("venue_bookings")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  REFUNDED
  PARTIALLY_REFUNDED
}

model Payment {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  amount   Float
  currency String        @default("USD")
  status   PaymentStatus

  gateway              String
  gatewayTransactionId String?

  description String?
  metadata    Json?

  refundAmount Float?
  refundReason String?
  refundedAt   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  eventRegistrations EventRegistration[]
  venueBookings      VenueBooking[]

  @@map("payments")
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
  PARTIALLY_REFUNDED
}

model Message {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  senderId   String @db.ObjectId
  sender     User?  @relation("MessageSender", fields: [senderId], references: [id])
  receiverId String @db.ObjectId
  receiver   User?  @relation("MessageReceiver", fields: [receiverId], references: [id])

  subject     String?
  content     String
  attachments String[]

  threadId  String?
  replyToId String? @db.ObjectId

  isRead Boolean   @default(false)
  readAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("messages")
}

model Notification {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User?   @relation(fields: [userId], references: [id])

  type    NotificationType
  title   String
  message String

  channels NotificationChannel[]

  isRead Boolean   @default(false)
  readAt DateTime?

  priority String @default("NORMAL")

  metadata Json?

  // Add this field for role-based notifications
  userRole String[] @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
  @@index([type])
  @@map("notifications")
}

// Update the NotificationType enum to include more types
enum NotificationType {
  EVENT_REMINDER
  REGISTRATION_CONFIRMATION
  PAYMENT_CONFIRMATION
  MESSAGE_RECEIVED
  BOOKING_CONFIRMATION
  SYSTEM_UPDATE
  CONNECTION_REQUEST
  CONNECTION_ACCEPTED
  CONNECTION_UPDATE
  APPOINTMENT_REQUEST
  APPOINTMENT_CONFIRMED
  APPOINTMENT_CANCELLED
  APPOINTMENT_REMINDER
  EVENT_APPROVED
  EVENT_REJECTED
  EVENT_PENDING
  EVENT_CREATED
  NEW_USER_REGISTERED
  TICKET_SOLD
  REVIEW_RECEIVED
  LEAD_RECEIVED
}

enum NotificationChannel {
  PUSH
  EMAIL
  SMS
}

model Campaign {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  type        CampaignType

  targetAudience Json

  subject  String?
  content  String
  template String?

  scheduledAt DateTime?
  sentAt      DateTime?

  status CampaignStatus @default(DRAFT)

  totalSent    Int @default(0)
  totalOpened  Int @default(0)
  totalClicked Int @default(0)

  createdById String  @db.ObjectId
  createdBy   User    @relation(fields: [createdById], references: [id])
  eventId     String? @db.ObjectId
  event       Event?  @relation(fields: [eventId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("campaigns")
}

enum CampaignType {
  EMAIL
  PUSH
  SMS
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENT
  CANCELLED
}

model Review {
  id     String  @id @default(auto()) @map("_id") @db.ObjectId
  userId String? @db.ObjectId
  user   User?   @relation(fields: [userId], references: [id])

  eventId     String?       @db.ObjectId
  event       Event?        @relation(fields: [eventId], references: [id])
  exhibitorId String?       @db.ObjectId
  exhibitor   User?         @relation("ExhibitorReviews", fields: [exhibitorId], references: [id])
  venueId     String?       @db.ObjectId
  venue       User?         @relation("VenueReviews", fields: [venueId], references: [id])
  organizerId String?       @db.ObjectId
  organizer   User?         @relation("OrganizerReviews", fields: [organizerId], references: [id])
  replies     ReviewReply[]

  rating  Int
  title   String?
  comment String?

  isApproved Boolean @default(false)
  isPublic   Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("reviews")
}

model Analytics {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  entityType String
  entityId   String @db.ObjectId

  views       Int   @default(0)
  clicks      Int   @default(0)
  conversions Int   @default(0)
  revenue     Float @default(0)

  date     DateTime
  source   String?
  medium   String?
  campaign String?
  country  String?
  city     String?
  device   String?
  browser  String?

  createdAt DateTime @default(now())

  @@map("analytics")
}

model EventAnalytics {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id])

  totalRegistrations Int   @default(0)
  totalRevenue       Float @default(0)
  conversionRate     Float @default(0)

  pageViews         Int   @default(0)
  uniqueVisitors    Int   @default(0)
  averageTimeOnPage Float @default(0)

  topCountries Json?
  topCities    Json?

  trafficSources Json?

  date      DateTime
  createdAt DateTime @default(now())

  @@map("event_analytics")
}

model UserAnalytics {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  loginCount      Int   @default(0)
  eventsAttended  Int   @default(0)
  eventsOrganized Int   @default(0)
  totalSpent      Float @default(0)

  lastActiveAt           DateTime?
  averageSessionDuration Float     @default(0)

  date      DateTime
  createdAt DateTime @default(now())

  @@map("user_analytics")
}

model VenueAnalytics {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  venueId String @db.ObjectId
  venue   User   @relation(fields: [venueId], references: [id])

  totalBookings Int   @default(0)
  totalRevenue  Float @default(0)
  occupancyRate Float @default(0)

  averageRating Float @default(0)
  totalReviews  Int   @default(0)

  date      DateTime
  createdAt DateTime @default(now())

  @@map("venue_analytics")
}

model Settings {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  emailNotifications Boolean @default(true)
  pushNotifications  Boolean @default(true)
  smsNotifications   Boolean @default(false)

  profileVisibility String  @default("public")
  showEmail         Boolean @default(false)
  showPhone         Boolean @default(false)

  marketingEmails Boolean @default(true)
  eventUpdates    Boolean @default(true)

  theme    String @default("light")
  language String @default("en")
  timezone String @default("UTC")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}

model Broadcast {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  content     String
  type        String
  status      String    @default("DRAFT")
  scheduledAt DateTime?
  sentAt      DateTime?

  senderId String @db.ObjectId
  sender   User   @relation("BroadcastSender", fields: [senderId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  recipients BroadcastRecipient[]

  @@map("broadcasts")
}

model BroadcastRecipient {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  broadcastId  String    @db.ObjectId
  userId       String    @db.ObjectId
  status       String    @default("PENDING")
  sentAt       DateTime?
  deliveredAt  DateTime?
  readAt       DateTime?
  errorMessage String?

  broadcast Broadcast @relation(fields: [broadcastId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([broadcastId, userId])
  @@map("broadcast_recipients")
}

model EventLead {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String? @db.ObjectId
  event   Event?  @relation(fields: [eventId], references: [id])
  userId  String? @db.ObjectId
  user    User?   @relation(fields: [userId], references: [id])

  ticketTypeId String?     @db.ObjectId
  ticketType   TicketType? @relation(fields: [ticketTypeId], references: [id])

  type   LeadType
  status LeadStatus @default(NEW)
  notes  String?

  contactedAt  DateTime?
  followUpDate DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([eventId, userId, type])
  @@map("event_leads")
}

enum LeadType {
  ATTENDEE
  EXHIBITOR
  SPEAKER
  SPONSOR
  PARTNER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  REJECTED
  FOLLOW_UP
}

model Connection {
  id         String           @id @default(auto()) @map("_id") @db.ObjectId
  senderId   String           @db.ObjectId
  receiverId String           @db.ObjectId
  message    String?
  status     ConnectionStatus @default(PENDING)
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  acceptedAt DateTime?

  sender   User? @relation("ConnectionSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User? @relation("ConnectionReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([senderId])
  @@index([receiverId])
  @@index([status])
  @@map("connections")
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  REJECTED
  BLOCKED
}

// Add new model for saved events
model SavedEvent {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  userId  String   @db.ObjectId
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  eventId String   @db.ObjectId
  event   Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  savedAt DateTime @default(now())

  @@unique([userId, eventId])
  @@map("saved_events")
}

model ReviewReply {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  reviewId String @db.ObjectId
  review   Review @relation(fields: [reviewId], references: [id])

  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  content          String
  isOrganizerReply Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("review_replies")
}

model ExhibitorManual {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)

  // File Information
  fileName String
  fileUrl  String // Blob storage URL
  fileSize Int // Size in bytes
  mimeType String @default("application/pdf")

  // Metadata
  uploadedById String  @db.ObjectId
  uploadedBy   User    @relation("ExhibitorManualUploads", fields: [uploadedById], references: [id])
  description  String?
  version      String? @default("1.0")

  // Status
  isActive Boolean @default(true)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("exhibitor_manuals")
}

model Follow {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  followerId  String   @db.ObjectId
  followingId String   @db.ObjectId
  createdAt   DateTime @default(now())

  follower  User @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follows")
}

model Conference {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  eventId String @db.ObjectId
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)

  date  String
  day   String
  theme String

  isPublished Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessions ConferenceSession[]

  @@map("conferences")
}

model ConferenceSession {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  conferenceId String     @db.ObjectId
  conference   Conference @relation(fields: [conferenceId], references: [id], onDelete: Cascade)

  time        String
  title       String
  description String?
  speaker     String?
  type        ConferenceSessionType @default(SESSION)

  order Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("conference_sessions")
}

enum ConferenceSessionType {
  SESSION
  BREAK
  KEYNOTE
  PANEL
  NETWORKING
}

model Product {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  category    String?
  description String?
  price       Float?
  currency    String?
  images      String[]
  brochure    String[]
  youtube     String[]
  exhibitorId String   @db.ObjectId
  exhibitor   User     @relation(fields: [exhibitorId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model LegalDocument {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  name        String
  description String?
  type        LegalDocumentType
  category    LegalDocumentCategory

  fileName String?
  fileUrl  String?
  fileSize Int?
  mimeType String?

  version String @default("1.0")

  status LegalDocumentStatus @default(ACTIVE)

  venueId String @db.ObjectId
  venue   User?  @relation("VenueLegalDocuments", fields: [venueId], references: [id], onDelete: Cascade)

  eventId       String?   @db.ObjectId
  organizerName String?
  organizerId   String?   @db.ObjectId
  contractValue Float?
  currency      String?   @default("INR")
  eventDate     DateTime?
  signedDate    DateTime?

  issuingAuthority  String?
  certificateNumber String?
  issueDate         DateTime?
  expiryDate        DateTime?

  downloadCount    Int       @default(0)
  lastDownloadedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([venueId])
  @@index([type])
  @@index([category])
  @@index([status])
  @@map("legal_documents")
}

enum LegalDocumentType {
  STANDARD_DOCUMENT
  EVENT_CONTRACT
  COMPLIANCE_CERTIFICATE
}

enum LegalDocumentCategory {
  TERMS_CONDITIONS
  CONTRACT_TEMPLATE
  WAIVER
  SERVICE_AGREEMENT
  BOOKING_AGREEMENT
  FIRE_SAFETY
  OCCUPANCY_CERTIFICATE
  FOOD_LICENSE
  ENTERTAINMENT_LICENSE
  BUILDING_PERMIT
  INSURANCE
  OTHER
}

enum LegalDocumentStatus {
  ACTIVE
  INACTIVE
  DRAFT
  SIGNED
  PENDING_SIGNATURE
  EXPIRED
  VALID
  EXPIRING_SOON
}

// Venue Appointment Management Model
model VenueAppointment {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // Venue and Requester
  venueId String? @db.ObjectId
  venue   User?   @relation("VenueAppointments", fields: [venueId], references: [id])

  requesterId String? @db.ObjectId
  requester   User?   @relation("VenueAppointmentRequests", fields: [requesterId], references: [id])

  // Optional Event Association
  eventId String? @db.ObjectId

  // Appointment Details
  title       String
  description String?
  type        VenueAppointmentType @default(VENUE_TOUR)
  status      AppointmentStatus    @default(PENDING)
  priority    AppointmentPriority  @default(MEDIUM)

  // Date and Time
  requestedDate DateTime
  requestedTime String
  duration      Int // Duration in minutes
  confirmedDate DateTime?
  confirmedTime String?

  // Meeting Details
  meetingType MeetingType @default(IN_PERSON)
  location    String? // Specific location within venue
  meetingLink String? // For virtual meetings

  // Additional Information
  purpose String?
  agenda  String[]
  notes   String?
  outcome String?

  // Requester Information
  requesterCompany String?
  requesterTitle   String?
  requesterPhone   String?
  requesterEmail   String?

  // Event Details (if applicable)
  eventType         String?
  expectedAttendees Int?
  eventDate         DateTime?

  // Meeting Spaces of Interest
  meetingSpacesInterested String[]

  // Follow-up
  reminderSent     Boolean @default(false)
  followUpRequired Boolean @default(true)
  followUpNotes    String?

  // Cancellation
  cancellationReason String?
  cancelledBy        String?
  cancelledAt        DateTime?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([venueId])
  @@index([requesterId])
  @@index([status])
  @@index([requestedDate])
  @@map("venue_appointments")
}

enum VenueAppointmentType {
  VENUE_TOUR
  CONSULTATION
  SITE_INSPECTION
  EVENT_PLANNING
  TECHNICAL_DISCUSSION
  CONTRACT_DISCUSSION
  FOLLOW_UP
}

// Add to your existing Prisma schema
model VerificationCode {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  type      String // EMAIL, PHONE
  code      String
  verified  Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@unique([userId, type])
  @@map("verification_codes")
}

model BadgeSent {
  id         String          @id @default(auto()) @map("_id") @db.ObjectId
  eventId    String          @db.ObjectId
  attendeeId String          @db.ObjectId
  email      String
  badgeUrl   String?
  sentAt     DateTime        @default(now())
  status     BadgeSentStatus @default(SENT)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([eventId])
  @@index([attendeeId])
  @@index([email])
  @@map("badges_sent")
}

// Dashboard Content Management System
model DashboardContent {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // Target dashboard
  dashboardType DashboardType // Which dashboard this content belongs to
  userRole      UserRole // Which user role sees this content

  // Header/Banner Content
  bannerTitle       String?
  bannerSubtitle    String?
  bannerDescription String?
  bannerImage       String? // URL to banner image

  // Main Content Sections
  welcomeTitle    String?
  welcomeMessage  String?
  quickStatsTitle String?

  // Features/Modules Section
  featuresTitle String?
  features      Json? // Array of { title: string, description: string, icon: string }

  // Support/Help Section
  supportTitle       String?
  supportDescription String?
  supportEmail       String?
  supportPhone       String?

  // Quick Actions
  quickActionsTitle String?
  quickActions      Json? // Array of { title: string, description: string, icon: string, link: string }

  // Custom Messages
  announcementTitle   String?
  announcementMessage String?
  announcementType    String? // info, warning, success, error

  // SEO/Meta
  metaTitle       String?
  metaDescription String?
  keywords        String[]

  isActive Boolean @default(true)
  version  Int     @default(1)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  updatedBy String?  @db.ObjectId // Super admin who last updated

  @@unique([dashboardType, userRole])
  @@map("dashboard_content")
}

// FAQ Management (Shared across dashboards)
model FAQ {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  question String
  answer   String
  category String? // General, Technical, Billing, etc.

  // Target audience
  userRoles      UserRole[] // Which roles should see this FAQ
  dashboardTypes DashboardType[] // Which dashboards should show this FAQ

  order    Int     @default(0)
  isActive Boolean @default(true)
  views    Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  updatedBy String?  @db.ObjectId

  @@map("faqs")
}

// Announcements/Banners
model DashboardAnnouncement {
  id      String           @id @default(auto()) @map("_id") @db.ObjectId
  title   String
  message String
  type    AnnouncementType @default(INFO)

  // Target settings
  userRoles      UserRole[]
  dashboardTypes DashboardType[]

  // Display settings
  startDate     DateTime?
  endDate       DateTime?
  isActive      Boolean   @default(true)
  isDismissible Boolean   @default(true)

  // Appearance
  backgroundColor String?
  textColor       String?
  icon            String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  updatedBy String?  @db.ObjectId

  @@map("dashboard_announcements")
}

// Help & Support Content (Specific to help pages)
model HelpSupportContent {
  id       String   @id @default(auto()) @map("_id") @db.ObjectId
  userRole UserRole // Role-specific help content

  // Header
  pageTitle       String
  pageDescription String

  // Contact Sections
  contactTitle       String?
  contactDescription String?

  // Support Channels
  supportEmail  String
  supportPhone  String
  officeAddress String
  corporateName String
  liveChatHours String

  // Section Titles
  emailTitle          String?
  emailDescription    String?
  phoneTitle          String?
  phoneDescription    String?
  officeTitle         String?
  officeDescription   String?
  liveChatTitle       String?
  liveChatDescription String?
  faqTitle            String?

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  updatedBy String?  @db.ObjectId

  @@unique([userRole])
  @@map("help_support_content")
}

// Enum for dashboard types
enum DashboardType {
  SUPER_ADMIN_DASHBOARD
  ORGANIZER_DASHBOARD
  EXHIBITOR_DASHBOARD
  SPEAKER_DASHBOARD
  VENUE_DASHBOARD
  ATTENDEE_DASHBOARD
  VISITOR_DASHBOARD
}

// Enum for announcement types
enum AnnouncementType {
  INFO
  WARNING
  SUCCESS
  ERROR
  MAINTENANCE
  UPDATE
}

enum BadgeSentStatus {
  SENT
  FAILED
  BOUNCED
}

model EventCategory {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  icon      String?
  color     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  events EventsOnCategories[]

  @@map("event_categories")
}

model EventsOnCategories {
  id         String        @id @default(auto()) @map("_id") @db.ObjectId
  eventId    String        @db.ObjectId
  categoryId String        @db.ObjectId
  event      Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  category   EventCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  assignedAt DateTime      @default(now())

  @@unique([eventId, categoryId])
  @@map("events_on_categories")
}

// Support Ticket Management
model SupportTicket {
  id          String                @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  category    SupportTicketCategory
  priority    SupportTicketPriority @default(MEDIUM)
  status      SupportTicketStatus   @default(OPEN)

  // User who created the ticket
  userId   String   @db.ObjectId
  user     User     @relation("TicketCreator", fields: [userId], references: [id])
  userRole UserRole

  // Assigned support agent (optional)
  assignedToId String? @db.ObjectId
  assignedTo   User?   @relation("TicketAssignee", fields: [assignedToId], references: [id])

  // Ticket metadata
  attachments String[]
  metadata    Json?

  // Timestamps
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  closedAt  DateTime?

  // Relationships
  replies SupportTicketReply[]

  @@index([userId])
  @@index([assignedToId])
  @@index([status])
  @@index([priority])
  @@index([createdAt])
  @@map("support_tickets")
}

model SupportTicketReply {
  id       String        @id @default(auto()) @map("_id") @db.ObjectId
  ticketId String        @db.ObjectId
  ticket   SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  // User who created the reply (could be user or support agent)
  userId String @db.ObjectId
  user   User   @relation("TicketReplyAuthor", fields: [userId], references: [id])

  // Reply content
  message     String
  attachments String[]
  isInternal  Boolean  @default(false) // Internal notes not visible to user

  // Status update (if this reply changes ticket status)
  newStatus SupportTicketStatus?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ticketId])
  @@index([userId])
  @@index([createdAt])
  @@map("support_ticket_replies")
}

// Enums for Support Tickets
enum SupportTicketCategory {
  TECHNICAL_ISSUE
  BILLING
  ACCOUNT
  EVENT_REGISTRATION
  PAYMENT
  REFUND
  GENERAL_INQUIRY
  FEATURE_REQUEST
  BUG_REPORT
  OTHER
}

enum SupportTicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum SupportTicketStatus {
  OPEN
  IN_PROGRESS
  AWAITING_RESPONSE
  RESOLVED
  CLOSED
  REOPENED
}

// Country and City Management Models
model Country {
  id           String  @id @default(auto()) @map("_id") @db.ObjectId
  name         String  @unique
  code         String  @unique
  flag         String?
  flagPublicId String?
  currency     String  @default("USD")
  timezone     String  @default("UTC")
  isActive     Boolean @default(true)
  isPermitted  Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  cities City[]
  events EventsOnCountries[]

  // Remove the duplicate indexes since @unique already creates them
  @@index([isActive])
  @@index([isPermitted])
  @@map("countries")
}

model City {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  countryId     String  @db.ObjectId
  latitude      Float?
  longitude     Float?
  timezone      String  @default("UTC")
  image         String?
  imagePublicId String?
  isActive      Boolean @default(true)
  isPermitted   Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  country Country          @relation(fields: [countryId], references: [id], onDelete: Cascade)
  events  EventsOnCities[]

  @@unique([name, countryId])
  @@index([isActive])
  @@index([isPermitted])
  @@map("cities")
}

// Many-to-many relationship between Events and Countries
model EventsOnCountries {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  eventId    String   @db.ObjectId
  countryId  String   @db.ObjectId
  event      Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  country    Country  @relation(fields: [countryId], references: [id], onDelete: Cascade)
  assignedAt DateTime @default(now())

  @@unique([eventId, countryId])
  @@map("events_on_countries")
}

// Many-to-many relationship between Events and Cities
model EventsOnCities {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  eventId    String   @db.ObjectId
  cityId     String   @db.ObjectId
  event      Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  city       City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
  assignedAt DateTime @default(now())

  @@unique([eventId, cityId])
  @@map("events_on_cities")
}

model AdminNote {
  id             String          @id @default(auto()) @map("_id") @db.ObjectId
  title          String
  content        String
  category       String          @default("General")
  tags           String[]
  visibility     NoteVisibility  @default(PRIVATE)
  userRoles      UserRole[]
  dashboardTypes DashboardType[]
  isPinned       Boolean         @default(false)
  isArchived     Boolean         @default(false)
  archivedAt     DateTime?

  // Relationships - make both fields optional
  createdById String? @db.ObjectId
  createdBy   User?   @relation("AdminNoteCreator", fields: [createdById], references: [id], onDelete: SetNull)

  collaborators NoteCollaborator[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admin_notes")
}

model NoteCollaborator {
  id         String                 @id @default(auto()) @map("_id") @db.ObjectId
  noteId     String                 @db.ObjectId
  userId     String                 @db.ObjectId
  permission CollaboratorPermission @default(VIEW)

  // Relationships
  note AdminNote @relation(fields: [noteId], references: [id], onDelete: Cascade)
  user User      @relation("NoteCollaborations", fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([noteId, userId])
  @@map("note_collaborators")
}

// Add these enums to your schema
enum NoteVisibility {
  PRIVATE
  TEAM
  PUBLIC
}

enum CollaboratorPermission {
  VIEW
  EDIT
  MANAGE
}

// Email Campaigns
model EmailCampaign {
  id              String    @id @default(auto()) @map("_id") @db.ObjectId
  title           String
  subject         String
  content         String
  htmlContent     String?
  status          String    @default("draft") // draft, scheduled, sending, sent, paused, cancelled
  priority        String    @default("medium") // low, medium, high, urgent
  targetAudiences String[]
  scheduledAt     DateTime?
  sentAt          DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Stats
  totalRecipients Int @default(0)
  sent            Int @default(0)
  delivered       Int @default(0)
  opened          Int @default(0)
  clicked         Int @default(0)
  bounced         Int @default(0)
  unsubscribed    Int @default(0)

  // Engagement rates (calculated fields)
  openRate        Float @default(0)
  clickRate       Float @default(0)
  deliveryRate    Float @default(0)
  bounceRate      Float @default(0)
  unsubscribeRate Float @default(0)

  // Relations
  recipients EmailRecipient[]

  @@map("email_campaigns")
}

model EmailRecipient {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  campaignId     String    @db.ObjectId
  recipientEmail String
  recipientName  String?
  status         String    @default("pending") // pending, sent, delivered, opened, clicked, bounced, unsubscribed
  sentAt         DateTime?
  deliveredAt    DateTime?
  openedAt       DateTime?
  clickedAt      DateTime?
  bouncedAt      DateTime?
  unsubscribedAt DateTime?
  errorMessage   String?

  campaign EmailCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([recipientEmail])
  @@map("email_recipients")
}

// Email Templates
model EmailTemplate {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  subject     String
  content     String
  htmlContent String?
  category    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("email_templates")
}

// Push Notifications
model PushNotification {
  id              String    @id @default(auto()) @map("_id") @db.ObjectId
  title           String
  message         String
  imageUrl        String?
  actionUrl       String?
  status          String    @default("draft") // draft, scheduled, sending, sent, paused, cancelled
  priority        String    @default("medium") // low, medium, high, urgent
  targetAudiences String[]
  targetPlatforms String[] // ios, android, web
  scheduledAt     DateTime?
  sentAt          DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Stats
  totalRecipients Int @default(0)
  sent            Int @default(0)
  delivered       Int @default(0)
  opened          Int @default(0)
  clicked         Int @default(0)
  failed          Int @default(0)

  // Engagement rates
  deliveryRate Float @default(0)
  openRate     Float @default(0)
  clickRate    Float @default(0)
  failureRate  Float @default(0)

  // Relations
  recipients PushRecipient[]

  @@map("push_notifications")
}

model PushRecipient {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  notificationId String    @db.ObjectId
  deviceToken    String
  platform       String // ios, android, web
  userId         String?
  status         String    @default("pending") // pending, sent, delivered, opened, clicked, failed
  sentAt         DateTime?
  deliveredAt    DateTime?
  openedAt       DateTime?
  clickedAt      DateTime?
  failedAt       DateTime?
  errorMessage   String?

  notification PushNotification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@index([deviceToken])
  @@map("push_recipients")
}

// Push Notification Templates
model PushTemplate {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  title     String
  message   String
  imageUrl  String?
  category  String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("push_templates")
}

model Banner {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  page        String // "homepage", "events", "event-detail", "speakers", etc.
  title       String
  imageUrl    String // Cloudinary URL
  publicId    String // Cloudinary public ID for deletion
  link        String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  clickCount  Int      @default(0)
  impressions Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("banners")
}

model Subscription {
  id                 String             @id @default(auto()) @map("_id") @db.ObjectId
  userId             String             @db.ObjectId
  user               User               @relation(fields: [userId], references: [id])
  planType           SubscriptionPlan
  status             SubscriptionStatus @default(ACTIVE)
  startDate          DateTime
  endDate            DateTime?
  billingCycle       BillingCycle       @default(MONTHLY)
  amount             Float
  currency           String             @default("USD")
  autoRenew          Boolean            @default(true)
  cancelledAt        DateTime?
  cancellationReason String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  @@map("subscriptions")
}

enum SubscriptionPlan {
  BASIC
  PREMIUM
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  PAUSED
}

enum BillingCycle {
  MONTHLY
  QUARTERLY
  YEARLY
}

model PaymentGateway {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String // "Stripe", "PayPal", "Razorpay"
  provider      String
  isActive      Boolean   @default(false)
  apiKey        String?
  secretKey     String?
  webhookSecret String?
  testMode      Boolean   @default(true)
  config        Json?
  lastSyncAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("payment_gateways")
}

model CommunicationProvider {
  id         String            @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  type       CommunicationType
  provider   String // "SendGrid", "Twilio", etc.
  isActive   Boolean           @default(false)
  apiKey     String?
  apiSecret  String?
  config     Json?
  lastSyncAt DateTime?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt

  @@map("communication_providers")
}

enum CommunicationType {
  EMAIL
  SMS
  PUSH
}

model CalendarIntegration {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  provider     String // "Google", "Outlook", "Apple"
  isConnected  Boolean   @default(false)
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime?
  lastSyncAt   DateTime?
  config       Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@map("calendar_integrations")
}

model APIKey {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  key         String    @unique
  permissions String[]
  rateLimit   Int       @default(1000)
  isActive    Boolean   @default(true)
  expiresAt   DateTime?
  lastUsedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("api_keys")
}

model Webhook {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  url             String
  events          String[]
  secret          String
  isActive        Boolean       @default(true)
  status          WebhookStatus @default(ACTIVE)
  lastTriggeredAt DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("webhooks")
}

enum WebhookStatus {
  ACTIVE
  FAILED
  DISABLED
}

model TravelPartner {
  id             String            @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  type           TravelPartnerType
  logo           String?
  isActive       Boolean           @default(true)
  commissionRate Float
  apiKey         String?
  config         Json?
  totalBookings  Int               @default(0)
  totalRevenue   Float             @default(0)
  lastSyncAt     DateTime?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt

  @@map("travel_partners")
}

enum TravelPartnerType {
  HOTEL
  AIRLINE
  CAR_RENTAL
  TRAVEL_AGENCY
}

model PlatformModule {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String   @unique
  displayName  String
  description  String?
  isEnabled    Boolean  @default(true)
  version      String
  config       Json?
  permissions  String[]
  dependencies String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("platform_modules")
}

model BackupSchedule {
  id        String          @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  frequency BackupFrequency
  time      String // "02:00"
  retention Int // days
  isActive  Boolean         @default(true)
  storage   String // "local", "s3", "gcs"
  config    Json?
  lastRunAt DateTime?
  nextRunAt DateTime?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@map("backup_schedules")
}

model BackupHistory {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  scheduleId  String?      @db.ObjectId
  type        BackupType
  size        Float // in MB
  status      BackupStatus
  storage     String
  path        String?
  error       String?
  startedAt   DateTime
  completedAt DateTime?
  createdAt   DateTime     @default(now())

  @@map("backup_history")
}

enum BackupFrequency {
  HOURLY
  DAILY
  WEEKLY
  MONTHLY
}

enum BackupType {
  FULL
  INCREMENTAL
  MANUAL
}

enum BackupStatus {
  IN_PROGRESS
  COMPLETED
  FAILED

}


model PromotionPackage {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String
  price       Float
  features    String[]
  userCount   Int
  duration    String   // "7 days", "14 days", "30 days"
  durationDays Int
  categories  String[] // ["selected"], ["multiple"], ["all"]
  recommended Boolean  @default(false)
  isActive    Boolean  @default(true)
  userType    String   // "BOTH", "EXHIBITOR", "ORGANIZER"
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("promotion_packages")
}

